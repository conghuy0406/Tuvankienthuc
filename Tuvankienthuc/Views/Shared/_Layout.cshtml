@{
    var currentController = ViewContext.RouteData.Values["controller"]?.ToString();
    var currentAction = ViewContext.RouteData.Values["action"]?.ToString();

    var title = ViewData["Title"] as string ?? "2PIG Learning";

    var userId = Context.Session.GetInt32("UserId");
    var userName = Context.Session.GetString("UserName");
    var role = Context.Session.GetString("Role");

    bool isLoggedIn = userId != null;
    bool isAdmin =
        string.Equals(role, "Admin", StringComparison.OrdinalIgnoreCase) ||
        string.Equals(role, "GiangVien", StringComparison.OrdinalIgnoreCase) ||
        string.Equals(role, "GiaoVien", StringComparison.OrdinalIgnoreCase);

    bool isFullLayout = ViewData["LayoutFull"] as bool? ?? false;
}

<!doctype html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@title</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600;700&display=swap" rel="stylesheet" />

    <!-- CSS -->
    <link href="~/css/bootstrap.min.css" rel="stylesheet" />
    <link href="~/css/bootstrap-icons.css" rel="stylesheet" />
    <link href="~/css/templatemo-topic-listing.css" rel="stylesheet" />

    <style>
        body {
            font-family: 'Montserrat', sans-serif;
        }

        /* LOGO */
        .logo-icon,
        .logo-text {
            background: linear-gradient(90deg,#89D2C5,#8FAFD6,#8E7CC3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo-icon {
            font-size: 32px;
        }

        .logo-text {
            font-size: 28px;
            font-weight: 800;
        }

        /* NAV LINK */
        .navbar .nav-link {
            font-weight: 600;
            font-size: 16px;
            color: #222 !important;
            transition: .2s;
        }

            .navbar .nav-link:hover {
                color: #89D2C5 !important;
            }

        /* 🐱 CAT ACTIVE (TAI MÈO) */
        .navbar .cat-active {
            position: relative;
            color: #89D2C5 !important;
            border: 2px solid #89D2C5;
            border-radius: 999px;
            padding: 6px 18px;
            font-weight: 700;
            background: #fff;
        }

            .navbar .cat-active::before,
            .navbar .cat-active::after {
                content: "";
                position: absolute;
                top: -9px;
                width: 14px;
                height: 14px;
                background: #fff;
                border: 2px solid #89D2C5;
                border-bottom: none;
                transform: rotate(45deg);
            }

            .navbar .cat-active::before {
                left: 12px;
            }

            .navbar .cat-active::after {
                right: 12px;
            }

        /* GREETING */
        .greeting-text {
            font-weight: 700;
            font-size: 16px;
            background: linear-gradient(90deg,#89D2C5,#8FAFD6,#8E7CC3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    </style>

    @RenderSection("Styles", false)
</head>

<body>

    <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm fixed-top">
        <div class="container">

            <!-- LOGO -->
            <a class="navbar-brand d-flex align-items-center"
               asp-controller="Home" asp-action="Index">
                <i class="bi bi-mortarboard-fill logo-icon me-2"></i>
                <span class="logo-text">2PIG</span>
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">

                <!-- LEFT MENU -->
                <ul class="navbar-nav me-auto">

                    <li class="nav-item">
                        <a class="nav-link @(currentController == "Home" && currentAction == "Index" ? "cat-active" : "")"
                           asp-controller="Home" asp-action="Index">
                            TRANG CHỦ
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link @(currentController == "Home" && currentAction != "Index" ? "cat-active" : "")"
                           asp-controller="Home" asp-action="Index" asp-fragment="section_2">
                            CHỦ ĐỀ
                        </a>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link @(currentController == "TuVan" ? "cat-active" : "")"
                           asp-controller="TuVan" asp-action="Index">
                            TƯ VẤN HỌC TẬP
                        </a>
                    </li>

                    @if (isAdmin)
                    {
                        <li class="nav-item">
                            <a class="nav-link text-danger"
                               asp-controller="QuanTriVien" asp-action="Index">
                                QUẢN TRỊ
                            </a>
                        </li>
                    }
                </ul>

                <!-- RIGHT MENU -->
                <ul class="navbar-nav ms-auto">
                    @if (!isLoggedIn)
                    {
                        <li class="nav-item">
                            <a class="nav-link" asp-controller="Auth" asp-action="Login">ĐĂNG NHẬP</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" asp-controller="Auth" asp-action="Register">ĐĂNG KÝ</a>
                        </li>
                    }
                    else
                    {
                        <li class="nav-item d-flex align-items-center me-3">
                            <span class="greeting-text">👋 Xin chào, <strong>@userName</strong></span>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" asp-controller="Auth" asp-action="Logout">
                                <i class="bi bi-box-arrow-right"></i>
                            </a>
                        </li>
                    }
                </ul>

            </div>
        </div>
    </nav>

    <main style="padding-top:30px">
        @if (isFullLayout)
        {
            @RenderBody()
        }
        else
        {
            <div class="container">
                @RenderBody()
            </div>
        }
    </main>

    <footer class="bg-dark text-light py-4 mt-5">
        <div class="container text-center small">
            © 2025 2PIG Learning System
        </div>
    </footer>

    <script src="~/js/bootstrap.bundle.min.js"></script>
    @RenderSection("Scripts", false)

</body>
</html>
