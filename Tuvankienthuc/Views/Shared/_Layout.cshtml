@{
    var title = ViewData["Title"] as string ?? "2PIG Learning";
    var userId = Context.Session.GetInt32("UserId");
    var userName = Context.Session.GetString("UserName");
    var role = Context.Session.GetString("Role");

    bool isLoggedIn = userId != null;
}

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@title</title>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- CSS -->
    <link href="~/css/bootstrap.min.css" rel="stylesheet" asp-append-version="true" />
    <link href="~/css/bootstrap-icons.css" rel="stylesheet" asp-append-version="true" />
    <link href="~/css/templatemo-topic-listing.css" rel="stylesheet" asp-append-version="true" />

    <style>
        :root {
            --primary: #0F766E;
            --primary-light: #14B8A6;
            --primary-soft: #F0FDFA;
            --accent: #F59E0B;
            --text-dark: #134E4A;
            --text-body: #334155;
            --text-muted: #64748B;
            --bg-body: #F8FAFC;
            --glass-nav: rgba(255, 255, 255, 0.95);
        }

        body {
            background-color: var(--bg-body);
            font-family: 'Montserrat', sans-serif;
            color: var(--text-body);
        }

        .navbar-custom {
            background: var(--glass-nav);
            backdrop-filter: blur(10px);
            padding: 12px 24px;
            border-radius: 50px;
            width: 95%;
            max-width: 1320px;
            margin: 20px auto 0;
            box-shadow: 0 4px 20px rgba(15, 118, 110, 0.08);
            border: 1px solid rgba(255,255,255,0.8);
            transition: .3s;
        }

            .navbar-custom.scrolled {
                margin-top: 10px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            }

        .navbar-brand {
            font-size: 26px;
            font-weight: 800;
            color: var(--primary) !important;
        }

        .navbar-nav .nav-link {
            font-weight: 600;
            color: var(--text-dark) !important;
            padding: 8px 20px !important;
            border-radius: 30px;
        }

            .navbar-nav .nav-link:hover,
            .navbar-nav .nav-link.active {
                background: var(--primary-soft);
                color: var(--primary) !important;
            }

        footer {
            background: #111827;
            padding: 60px 0 30px;
            border-top: 5px solid var(--primary);
        }

            footer h5, footer h6 {
                color: white;
                font-weight: 700;
            }

            footer p, footer a {
                color: #94A3B8 !important;
                text-decoration: none;
            }

                footer a:hover {
                    color: var(--primary-light) !important;
                    padding-left: 5px;
                }
    </style>

    @RenderSection("Styles", required: false)
</head>

<body>

    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-custom sticky-top">
        <div class="container-fluid px-4">

            <a class="navbar-brand d-flex align-items-center" asp-controller="Home" asp-action="Index">
                <i class="bi bi-journal-bookmark-fill me-2"></i> 2PIG
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav mx-auto">
                    <li class="nav-item">
                        <a class="nav-link" asp-controller="Home" asp-action="Index">Trang chủ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" asp-controller="TuVan" asp-action="Index">Tư vấn học tập</a>
                    </li>

                    @if (role == "GiangVien")
                    {
                        <li class="nav-item">
                            <a class="nav-link" style="color: var(--accent) !important"
                               asp-controller="GiangVien" asp-action="Index">
                                <i class="bi bi-briefcase"></i> Giảng viên
                            </a>
                        </li>
                    }

                    @if (role == "Admin")
                    {
                        <li class="nav-item">
                            <a class="nav-link text-danger" asp-controller="Admin" asp-action="Index">
                                <i class="bi bi-shield-lock"></i> Quản trị
                            </a>
                        </li>
                    }
                </ul>

                <ul class="navbar-nav ms-auto align-items-center">
                    @if (!isLoggedIn)
                    {
                        <li class="nav-item me-2">
                            <a class="nav-link btn btn-outline-success" asp-controller="Auth" asp-action="Login">Đăng nhập</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link btn btn-success text-white" asp-controller="Auth" asp-action="Register">Đăng ký</a>
                        </li>
                    }
                    else
                    {
                        <li class="nav-item d-flex align-items-center me-3">
                            <span class="fw-bold me-2">Hi, @userName</span>
                            <div class="bg-warning rounded-circle text-white d-flex justify-content-center align-items-center"
                                 style="width:38px;height:38px;">
                                @(userName?[0].ToString().ToUpper())
                            </div>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" asp-controller="Auth" asp-action="Logout">
                                <i class="bi bi-box-arrow-right"></i>
                            </a>
                        </li>
                    }
                </ul>
            </div>
        </div>
    </nav>

    <!-- MAIN -->
    <main class="mt-4">
        @RenderBody()
    </main>

    <!-- FOOTER -->
    <footer class="mt-auto">
        <div class="container text-center text-muted small">
            © 2025 2PIG Learning System
        </div>
    </footer>

    <!-- ================= JS ================= -->
    <!-- Bootstrap -->
    <script src="~/js/bootstrap.bundle.min.js"></script>

    <!-- ✅ BẮT BUỘC: jQuery (cho TuVan, Ajax, Timeline, Chart) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
            integrity="sha256-3gJwYp8pNQZ0r3nQq8Yx1Cq5c5e8JD7BqXc9Ejo4kL0="
            crossorigin="anonymous"></script>

    <script>
        window.addEventListener("scroll", function () {
            const nav = document.querySelector(".navbar-custom");
            if (window.scrollY > 20) nav.classList.add("scrolled");
            else nav.classList.remove("scrolled");
        });
    </script>

    @RenderSection("Scripts", required: false)

</body>
</html>
