@{
    ViewData["Title"] = "AI Learning Advisor";
}

<style>
    body {
        background: #eef1f6;
        font-family: 'Segoe UI', sans-serif;
    }

    .chat-layout {
        max-width: 1100px;
        height: 85vh;
        margin: 30px auto;
        display: grid;
        grid-template-columns: 260px 1fr;
        background: white;
        border-radius: 14px;
        box-shadow: 0 12px 30px rgba(0,0,0,0.08);
        overflow: hidden;
    }

    /* SIDEBAR */
    .chat-sidebar {
        background: #1e293b;
        color: #fff;
        padding: 24px;
        display: flex;
        flex-direction: column;
    }

        .chat-sidebar h5 {
            font-weight: 600;
            margin-bottom: 25px;
        }

    .sidebar-item {
        padding: 12px 14px;
        border-radius: 8px;
        margin-bottom: 10px;
        font-size: 14px;
        background: rgba(255,255,255,0.08);
    }

    /* MAIN CHAT */
    .chat-main {
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    .chat-header {
        padding: 18px 22px;
        border-bottom: 1px solid #eee;
        background: #f8fafc;
    }

        .chat-header h4 {
            margin: 0;
            font-weight: 600;
        }

    .chat-body {
        flex: 1;
        padding: 24px;
        overflow-y: auto;
        background: #f4f6fa;
    }

    .msg {
        max-width: 70%;
        padding: 14px 16px;
        border-radius: 12px;
        margin-bottom: 14px;
        font-size: 14.5px;
        line-height: 1.5;
    }

        .msg.user {
            margin-left: auto;
            background: #2563eb;
            color: white;
            border-bottom-right-radius: 4px;
        }

        .msg.bot {
            background: white;
            border: 1px solid #e5e7eb;
            color: #1f2937;
            border-bottom-left-radius: 4px;
        }

    .chat-footer {
        padding: 16px 20px;
        border-top: 1px solid #eee;
        background: #fff;
        display: flex;
        gap: 12px;
    }

        .chat-footer input {
            flex: 1;
            padding: 12px 18px;
            border-radius: 10px;
        }

        .chat-footer button {
            padding: 0 26px;
            border-radius: 10px;
            font-weight: 500;
        }

    .typing {
        font-size: 13px;
        color: #6b7280;
        margin-bottom: 10px;
    }
</style>

<div class="chat-layout">

    <!-- SIDEBAR -->
    <div class="chat-sidebar">
        <h5>AI Learning Advisor</h5>

        <div class="sidebar-item">
            📊 Dữ liệu học tập cá nhân
        </div>

        <div class="sidebar-item">
            📘 Đề xuất kiến thức
        </div>

        <div class="sidebar-item">
            🧠 Phân tích điểm yếu
        </div>

        <div class="sidebar-item">
            💬 Tư vấn AI
        </div>
    </div>

    <!-- CHAT MAIN -->
    <div class="chat-main">

        <div class="chat-header">
            <h4>Chat tư vấn học tập</h4>
            <small class="text-muted">
                Dựa trên dữ liệu đề xuất & kết quả học tập
            </small>
        </div>

        <div id="chatBody" class="chat-body">
            <div class="msg bot">
                Xin chào 👋 <br />
                Tôi sẽ tư vấn dựa trên tình hình học tập hiện tại của bạn.
            </div>
        </div>

        <div class="chat-footer">
            <input id="chatInput"
                   type="text"
                   class="form-control"
                   placeholder="Nhập câu hỏi học tập của bạn..."
                   autocomplete="off" />

            <button class="btn btn-primary" onclick="sendMessage()">
                Gửi
            </button>
        </div>

    </div>
</div>

<script>
    async function sendMessage() {
        const input = document.getElementById("chatInput");
        const body = document.getElementById("chatBody");
        const msg = input.value.trim();

        if (!msg) return;

        body.innerHTML += `<div class="msg user">${msg}</div>`;
        input.value = "";
        body.scrollTop = body.scrollHeight;

        const typing = document.createElement("div");
        typing.className = "typing";
        typing.innerText = "AI đang phân tích dữ liệu học tập...";
        body.appendChild(typing);
        body.scrollTop = body.scrollHeight;

        const res = await fetch("/Chat/Send", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message: msg })
        });

        const data = await res.json();
        typing.remove();

        body.innerHTML += `<div class="msg bot">${data.reply}</div>`;
        body.scrollTop = body.scrollHeight;
    }

    document.getElementById("chatInput")
        .addEventListener("keydown", e => {
            if (e.key === "Enter") sendMessage();
        });
</script>
