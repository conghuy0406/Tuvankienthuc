@model List<(Tuvankienthuc.Models.KienThuc kt, float score)>

@{
    var moTaKT = ViewBag.MoTaKT as Dictionary<int, string>;
    int daysLeft = ViewBag.DaysLeft;
    int index = 0;
}

<style>
    body {
        background: linear-gradient(180deg, #EAFBF7, #F4F7FF);
        font-size: 14px;
    }

    .page-title {
        font-weight: 800;
        font-size: 22px;
        background: linear-gradient(90deg,#2563EB,#7C3AED);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }

    /* CARD KIẾN THỨC */
    .roadmap-card {
        border-radius: 14px;
        box-shadow: 0 6px 18px rgba(0,0,0,.08);
    }

    .roadmap-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .urgency-badge {
        font-size: 12px;
        padding: 6px 12px;
        border-radius: 999px;
        font-weight: 600;
        white-space: nowrap;
    }

    .kt-meta {
        font-size: 13px;
        color: #555;
    }

    .kt-desc {
        background: #f8fafc;
        border-left: 4px solid #7C3AED;
        padding: 10px 12px;
        border-radius: 8px;
        font-size: 13px;
    }

    /* ALERT AI */
    .ai-box {
        background: linear-gradient(90deg,#2563EB,#7C3AED);
        color: white;
        border-radius: 14px;
        padding: 16px;
        box-shadow: 0 8px 24px rgba(0,0,0,.12);
    }

    .advice-box {
        background: #ffffff;
        border-radius: 14px;
        padding: 16px;
        box-shadow: 0 8px 24px rgba(0,0,0,.1);
        border-left: 5px solid #10B981;
    }
</style>

<div class="container my-4 pt-5" style="margin-top:70px; max-width:1000px;">

    <!-- TIÊU ĐỀ -->
    <h2 class="page-title mb-2">🚀 Kết quả tư vấn – @ViewBag.TenMonHoc</h2>

    <!-- AI MODEL -->
    <div class="ai-box mb-3">
        🤖 <strong>Mô hình AI:</strong> @ViewBag.AIModel<br />
        ⏳ <strong>Số ngày còn lại:</strong> @daysLeft ngày
    </div>

    <!-- LỜI KHUYÊN -->
    <div class="advice-box mb-4">
        <strong>💡 Lời khuyên học tập:</strong><br />
        @Html.Raw(ViewBag.LoiKhuyen)
    </div>

    <h5 class="fw-bold text-secondary mb-3">📌 Lộ trình kiến thức ưu tiên</h5>

    @foreach (var item in Model)
    {
        var kt = item.kt;
        var score = item.score;
        index++;

        string urgencyClass, urgencyLabel;

        if (score > 1.2f) { urgencyClass = "bg-danger"; urgencyLabel = "Rất cấp bách"; }
        else if (score > 0.9f) { urgencyClass = "bg-warning text-dark"; urgencyLabel = "Ưu tiên cao"; }
        else if (score > 0.6f) { urgencyClass = "bg-info text-dark"; urgencyLabel = "Nên học sớm"; }
        else if (score > 0.3f) { urgencyClass = "bg-secondary"; urgencyLabel = "Ôn nhẹ"; }
        else { urgencyClass = "bg-success"; urgencyLabel = "Đã ổn"; }

        int minutes = kt.DoKho >= 7 ? 40 :
        kt.DoKho >= 5 ? 30 :
        kt.DoKho >= 3 ? 25 : 20;

        int day = Math.Min(daysLeft, index);

        <div class="card roadmap-card border-0 mb-3">
            <div class="card-body">

                <div class="roadmap-header mb-1">
                    <h6 class="fw-bold mb-0">@kt.NoiDung</h6>
                    <span class="urgency-badge @urgencyClass">
                        @urgencyLabel · @score.ToString("0.00")
                    </span>
                </div>

                <div class="kt-meta mb-2">
                    📚 Chủ đề: <strong>@kt.ChuDe?.TenCD</strong> |
                    ⏱ @minutes phút |
                    📅 Ngày @day
                </div>

                @if (moTaKT != null && moTaKT.ContainsKey(kt.MaKT))
                {
                    <div class="kt-desc mt-2">
                        🧠 @moTaKT[kt.MaKT]
                    </div>
                }
            </div>
        </div>
    }

</div>
